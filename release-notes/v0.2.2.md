# Release Notes - v0.2.2

## Features

### PTerm UI Migration
- **Progress Spinners**: Replaced yacspin with pterm for consistent, modern progress indicators
- **Dynamic Tables**: New `DynamicTable` component with ANSI-aware key-value displays
- **Tree Views**: Hierarchical cluster/region visualization using pterm tree rendering
- **PTable**: PTerm-based table wrapper compatible with existing `ui.Table` interface

### AMI Status Detection
- **Multi-AMI Support**: Fixed AMI status detection for all EKS AMI types:
  - Amazon Linux 2 (AL2)
  - Amazon Linux 2023 (AL2023)
  - Bottlerocket
  - Windows Server 2019/2022
- Status now correctly shows `Current`, `Update Available`, or `Unknown`

### Cost Estimation
- **AWS Pricing API Integration**: Real-time on-demand pricing lookup
- **Monthly Projections**: `COST/MO` column shows estimated monthly cost per nodegroup
- **`--show-costs` Flag**: Enable cost display with `-C` or `--show-costs`

### CPU Utilization Metrics
- **CloudWatch Integration**: Fetch EC2 CPU utilization data
- **Configurable Window**: Support for 1h, 3h, and 24h timeframes
- **`--show-utilization` Flag**: Enable with `-U` or `--show-utilization`

### Dynamic Version Information
- **Build-time Injection**: Version, commit hash, and build date now injected via ldflags
- **Stacked Output**: Clean multi-line version display

## Bug Fixes

- Fixed flag parsing for subcommands (flags must precede positional arguments)
- Fixed 24h timeframe handling in utilization collector
- Expanded AWS region mappings for Pricing API (14 to 34 regions)
- Improved pricing lookup resilience with fallback filter strategies

## Technical Details

### New UI Components
- `ui.ProgressSpinner`: PTerm spinner wrapper with success/fail states
- `ui.ProgressBar`: PTerm progress bar for multi-step operations
- `ui.MultiProgressManager`: Concurrent progress tracking
- `ui.TreeBuilder`: Hierarchical data visualization
- `ui.DynamicTable`: Auto-width key-value tables

### Build System
- Updated `.goreleaser.yml` with correct ldflags for version injection
- Updated `Taskfile.yml` `build-release` task with commit/date variables
- Migrated from Homebrew Formula (`brews`) to Cask (`homebrew_casks`)

### Documentation
- Added flag ordering note to README and CLAUDE.md
- Added cost calculation explanation to README
- Created release notes for all previous versions

## Usage Examples

```bash
# List nodegroups with cost estimation
refresh nodegroup list --show-costs develop

# List with CPU utilization (24h window)
refresh nodegroup list --show-utilization --timeframe 24h develop

# Combined flags (short form)
refresh nodegroup list -U -C develop

# Check version with build info
refresh version
# Output:
# refresh version: v0.2.2
# commit: abc1234
# built: 2025-12-03T19:30:00Z
```

## Breaking Changes

- **Flag Ordering**: Flags must now precede positional arguments for subcommands
  - Correct: `refresh nodegroup list --show-costs develop`
  - Incorrect: `refresh nodegroup list develop --show-costs`

- **Homebrew Installation**: Changed from Formula to Cask
  - Old: `brew install dantech2000/tap/refresh`
  - New: `brew install --cask dantech2000/tap/refresh`
  - Updating: `brew upgrade --cask refresh`

## Notes

- Cost estimates use on-demand Linux pricing; actual costs may vary with Spot/Reserved instances
- CPU metrics require CloudWatch access; Container Insights not required for basic metrics
- AMI status detection uses SSM Parameter Store to find latest EKS-optimized AMIs

---

*Major feature release with PTerm UI migration, cost estimation, and utilization metrics.*
